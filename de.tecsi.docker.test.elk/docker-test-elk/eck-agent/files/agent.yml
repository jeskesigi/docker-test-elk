
agent:
  monitoring:
    enabled: true
    use_output: default
    logs: true
    metrics: true

providers.kubernetes:
  node: ${NODE_NAME}
  scope: node


# https://www.elastic.co/guide/en/fleet/current/elastic-agent-input-configuration.html
inputs:
  # Input ID allowing Elastic Agent to track the state of this input. Must be unique.
  - id: container-log-${kubernetes.pod.name}-${kubernetes.container.id}
    type: filestream
    use_output: default
    meta:
      package:
        name: kubernetes
        version: 1.52.0
    data_stream:
      namespace: default
    streams:
      # Stream ID for this data stream allowing Filebeat to track the state of the ingested files. Must be unique.
      # Each filestream data stream creates a separate instance of the Filebeat filestream input.
      - id: container-log-${kubernetes.pod.name}-${kubernetes.container.id}
        data_stream:
          dataset: kubernetes.container_logs
          type: logs
        prospector.scanner.symlinks: true
        parsers:
          - container: ~
          # - ndjson:
          #     target: json
          # - multiline:
          #     type: pattern
          #     pattern: '^\['
          #     negate: true
          #     match: after
        paths:
          - /var/log/containers/*${kubernetes.container.id}.log
# https://www.elastic.co/guide/en/fleet/current/elasticsearch-output.html
outputs:
  elasticsearch:
    type: elasticsearch
    hosts: ["https://quickstart-es-http:9200"]
    username: elastic
    password: jXsIe2B17Tv3xO96x4yuW549
    ssl.verification_mode: none
